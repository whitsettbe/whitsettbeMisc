<!DOCTYPE html>
<html>
<head>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
		integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2"
		crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"
		integrity="sha512-xRllwz2gdZciIB+AkEbeq+gVhX8VB8XsfqeFbUh+SzHlN96dEduwtTuVuc2u9EROlmW9+yhRlxjif66ORpsgVA=="
		crossorigin="anonymous"
		referrerpolicy="no-referrer"></script>
<link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"
		integrity="sha384-q94+BZtLrkL1/ohfjR8c6L+A6qzNH9R2hBLwyoAfu3i/WCvQjzL2RQJ3uNHDISdU"
		crossorigin="anonymous">
<script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"
		integrity="sha384-8Vi8VHwn3vjQ9eUHUxex3JSN/NFqUg3QbPyX8kWyb93+8AC/pPWTzj+nHtbC5bxD"
		crossorigin="anonymous"></script>
</head>
<body>

<div id="myBoard" style="width: 400px"></div>
<label>Status:</label>
<div id="status"></div>
<label>FEN:</label>
<div id="fen"></div>
<label>PGN:</label>
<div id="pgn"></div>

<script>
// game board script modified from https://chessboardjs.com/examples#5000 and https://chessboardjs.com/examples#5003

// NOTE: this example uses the chess.js library:
// https://github.com/jhlywa/chess.js

var board = null;
var game = new Chess();
var whiteSquareGrey = '#a9a9a9';
var blackSquareGrey = '#696969';
var $status = $('#status');
var $fen = $('#fen');
var $pgn = $('#pgn');

function removeGreySquares ()
{
	$('#myBoard .square-55d63').css('background', '');
}

function greySquare (square)
{
	var $square = $('#myBoard .square-' + square);

	var background = whiteSquareGrey;
	if ($square.hasClass('black-3c85d')) {
		background = blackSquareGrey;
	}

	$square.css('background', background);
}

function onDragStart (source, piece)
{
	// do not pick up pieces if the game is over
	if (game.game_over()) return false;

	// or if it's not that side's turn
	if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||
			(game.turn() === 'b' && piece.search(/^w/) !== -1)) {
		return false;
	}
}

function onDrop (source, target)
{
	removeGreySquares();

	// see if the move is legal
	var movedPiece = game.get(source);
	var move = game.move({
		from: source,
		to: target,
		promotion: 'q' // promote to queen by default, but we fix this below
	})

	// illegal move
	if (move === null) return 'snapback';
	
	// verify promotion
	if(movedPiece.type != game.get(target).type)
	{
		var prm = 0;
		for(; !confirm('Promote to a ' + ['Queen','Knight','Rook','Bishop'][prm] + '?\n'+
				'(Cancel to cycle options)'); prm = (prm + 1) % 4);
		game.undo();
		var move = game.move({
			from: source,
			to: target,
			promotion: 'qnrb'[prm]
		})
	}
	
	updateStatus();
}

function onMouseoverSquare (square, piece)
{
	// get list of possible moves for this square
	var moves = game.moves({
		square: square,
		verbose: true
	});

	// exit if there are no moves available for this square
	if (moves.length === 0) return;

	// highlight the square they moused over
	greySquare(square);

	// highlight the possible squares for this piece
	for (var i = 0; i < moves.length; i++)
	{
		greySquare(moves[i].to);
	}
}

function onMouseoutSquare (square, piece)
{
	removeGreySquares();
}

function onSnapEnd ()
{
	board.position(game.fen());
}

function updateStatus () {
	var status = ''

	var moveColor = 'White'
	if (game.turn() === 'b') {
		moveColor = 'Black'
	}

	// checkmate?
	if (game.in_checkmate()) {
		status = 'Game over, ' + moveColor + ' is in checkmate.'
	}

	// draw?
	else if (game.in_draw()) {
		status = 'Game over, drawn position'
	}

	// game still on
	else {
		status = moveColor + ' to move'

		// check?
		if (game.in_check()) {
			status += ', ' + moveColor + ' is in check'
		}
	}

	$status.html(status)
	$fen.html(game.fen())
	$pgn.html(game.pgn())
}

function pieceTheme(piece)
{
	switch(piece)
	{
		case 'wK':
			return 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/Chess_klt45.svg/240px-Chess_klt45.svg.png';
		case 'bK':
			return 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f0/Chess_kdt45.svg/240px-Chess_kdt45.svg.png';
		case 'wQ':
			return 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/15/Chess_qlt45.svg/240px-Chess_qlt45.svg.png';
		case 'bQ':
			return 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/47/Chess_qdt45.svg/240px-Chess_qdt45.svg.png';
		case 'wR':
			return 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Chess_rlt45.svg/240px-Chess_rlt45.svg.png';
		case 'bR':
			return 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/ff/Chess_rdt45.svg/240px-Chess_rdt45.svg.png';
		case 'wB':
			return 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b1/Chess_blt45.svg/240px-Chess_blt45.svg.png';
		case 'bB':
			return 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/98/Chess_bdt45.svg/240px-Chess_bdt45.svg.png';
		case 'wN':
			return 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/70/Chess_nlt45.svg/240px-Chess_nlt45.svg.png';
		case 'bN':
			return 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/ef/Chess_ndt45.svg/240px-Chess_ndt45.svg.png';
		case 'wP':
			return 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/45/Chess_plt45.svg/240px-Chess_plt45.svg.png';
		default:
			return 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/Chess_pdt45.svg/240px-Chess_pdt45.svg.png';
	}
}

var config = {
	draggable: true,
	position: 'start',
	onDragStart: onDragStart,
	onDrop: onDrop,
	onMouseoutSquare: onMouseoutSquare,
	onMouseoverSquare: onMouseoverSquare,
	onSnapEnd: onSnapEnd,
	pieceTheme: pieceTheme
}

board = Chessboard('myBoard', config);
updateStatus();
</script>

</body>
</html>